describe('YourComponent', () => {
  let component: YourComponent;
  let observeSpy: jasmine.Spy;
  let disconnectSpy: jasmine.Spy;

  beforeEach(() => {
    // ✅ MOCK ResizeObserver BEFORE TestBed
    observeSpy = jasmine.createSpy('observe');
    disconnectSpy = jasmine.createSpy('disconnect');

    (window as any).ResizeObserver = function (cb: any) {
      // Immediately simulate resize
      cb([{ contentRect: { width: 100, height: 100 } }]);
      return {
        observe: observeSpy,
        disconnect: disconnectSpy
      };
    };

    TestBed.configureTestingModule({
      declarations: [YourComponent],
    });

    const fixture = TestBed.createComponent(YourComponent);
    component = fixture.componentInstance;
  });

  it('should create real iframe, find #root inside body, and observe resize', (done) => {
    // ✅ Create real iframe
    const iframe = document.createElement('iframe');
    iframe.id = 'testIframe';
    document.body.appendChild(iframe);

    // ✅ Set iframe content and wait for load
    iframe.onload = () => {
      const iframeDoc = iframe.contentDocument!;
      const body = iframeDoc.body;

      // ✅ Create div#root inside iframe body
      const rootDiv = iframeDoc.createElement('div');
      rootDiv.id = 'root';
      body.appendChild(rootDiv);

      // Spy on the style override
      const styleSpy = spyOn(component, 'overrideIframeInsideDivStyle').and.callThrough();

      // ✅ Your component logic: call method to observe iframe
      component['resizeObserver'] = new ResizeObserver(() => {
        component.overrideIframeInsideDivStyle(rootDiv);
      });

      component.overrideIframeInsideDivStyle(rootDiv);
      component['resizeObserver'].observe(iframe);

      // ✅ Assertions
      expect(styleSpy).toHaveBeenCalledTimes(2); // Initial + ResizeObserver
      expect(observeSpy).toHaveBeenCalledWith(iframe);

      // Cleanup
      document.body.removeChild(iframe);
      done();
    };

    // ✅ Trigger iframe load with valid HTML content
    iframe.srcdoc = '<html><body></body></html>';
  });

  it('should disconnect ResizeObserver on destroy', () => {
    component['resizeObserver'] = new ResizeObserver(() => {});
    component.ngOnDestroy();
    expect(disconnectSpy).toHaveBeenCalled();
  });
});
