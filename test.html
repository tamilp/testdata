import { AfterViewInit, Component, ElementRef, Renderer2, OnDestroy } from '@angular/core';

@Component({
  selector: 'app-my-component',
  templateUrl: './my-component.component.html'
})
export class MyComponent implements AfterViewInit, OnDestroy {
  private resizeObserver!: ResizeObserver;

  constructor(private renderer: Renderer2, private elRef: ElementRef) {}

  ngAfterViewInit() {
    // Dynamically create iframe
    const iframe = this.renderer.createElement('iframe') as HTMLIFrameElement;
    iframe.src = 'https://example.com';
    iframe.style.width = '100%';
    iframe.style.height = '500px';
    iframe.style.border = 'none';
    iframe.id = 'dynamicIframe';

    // Append to container
    const container = this.elRef.nativeElement.querySelector('#iframe-container');
    this.renderer.appendChild(container, iframe);

    // Observe iframe resize
    this.resizeObserver = new ResizeObserver(entries => {
      for (let entry of entries) {
        const rect = entry.contentRect;
        console.log(`Iframe resized: width=${rect.width}, height=${rect.height}`);
        // Example style override after resize
        iframe.style.border = '2px solid green';
      }
    });

    this.resizeObserver.observe(iframe);
  }

  ngOnDestroy() {
    if (this.resizeObserver) {
      this.resizeObserver.disconnect();
    }
  }
}
