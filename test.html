describe('YourComponent', () => {
  let component: YourComponent;

  const observeSpy = jasmine.createSpy('observe');
  const disconnectSpy = jasmine.createSpy('disconnect');

  beforeEach(() => {
    // ✅ MOCK ResizeObserver BEFORE TestBed creation
    (window as any).ResizeObserver = function (cb: any) {
      // Immediately invoke the callback with a fake entry
      cb([{ contentRect: { width: 100, height: 100 } }]);
      return {
        observe: observeSpy,
        disconnect: disconnectSpy
      };
    };

    TestBed.configureTestingModule({
      declarations: [YourComponent]
    });

    const fixture = TestBed.createComponent(YourComponent);
    component = fixture.componentInstance;
  });

  it('should override iframe style and call ResizeObserver', () => {
    // Mock iframe DOM
    const mockBody = { style: {} };
    const mockIframeDoc = {
      getElementById: jasmine.createSpy().and.returnValue(mockBody)
    } as any;

    const mockIframeEl = {
      contentDocument: mockIframeDoc,
      contentWindow: { document: mockIframeDoc },
      style: {}
    } as any;

    // Spy on override method
    spyOn(component, 'overrideIframeInsideDivStyle');

    // Execute the code block manually as in loadWidgetJS
    const iframeDoc = mockIframeEl.contentDocument || mockIframeEl.contentWindow.document;
    const body = iframeDoc.getElementById('root');

    component.overrideIframeInsideDivStyle(body);

    component['resizeObserver'] = new ResizeObserver(() => {
      component.overrideIframeInsideDivStyle(body);
    });

    component['resizeObserver'].observe(mockIframeEl);

    // ✅ Assertions
    expect(mockIframeDoc.getElementById).toHaveBeenCalledWith('root');
    expect(component.overrideIframeInsideDivStyle).toHaveBeenCalledTimes(2);
    expect(observeSpy).toHaveBeenCalledWith(mockIframeEl);
  });

  it('should disconnect ResizeObserver on destroy', () => {
    component['resizeObserver'] = new ResizeObserver(() => {});
    component.ngOnDestroy();
    expect(disconnectSpy).toHaveBeenCalled();
  });
});
