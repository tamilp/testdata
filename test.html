function sortBranches<T>(
  arr: T[],
  sortBy: keyof T,
  order: 'asc' | 'desc' = 'asc',
  locale = 'en'
): T[] {
  const normalizedLocale = locale.replace(/_/g, '-');
  const othersRegex = /^others?\b/i; // Matches "Other" or "Others" at start

  return [...arr].sort((a, b) => {
    const aValue = a[sortBy];
    const bValue = b[sortBy];

    if (aValue == null && bValue == null) return 0;
    if (aValue == null) return 1;
    if (bValue == null) return -1;

    // Check if a or b starts with "Other"/"Others"
    const aIsOther = typeof aValue === 'string' && othersRegex.test(aValue);
    const bIsOther = typeof bValue === 'string' && othersRegex.test(bValue);

    // Always push "Other"/"Others" to the end
    if (aIsOther && !bIsOther) return 1;
    if (!aIsOther && bIsOther) return -1;
    if (aIsOther && bIsOther) {
      // Optional: sort "Other" items among themselves
      return aValue.localeCompare(bValue, normalizedLocale, { sensitivity: 'base' });
    }

    // Regular sorting
    if (typeof aValue === 'string' && typeof bValue === 'string') {
      const result = aValue.localeCompare(bValue, normalizedLocale, { sensitivity: 'base' });
      return order === 'asc' ? result : -result;
    }

    // Numeric or other type comparison
    if (aValue < bValue) return order === 'asc' ? -1 : 1;
    if (aValue > bValue) return order === 'asc' ? 1 : -1;

    return 0;
  });
}
