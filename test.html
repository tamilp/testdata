describe('YourComponent', () => {
  let component: YourComponent;
  let observeSpy: jasmine.Spy;
  let disconnectSpy: jasmine.Spy;
  let callbackRef: any;

  beforeEach(() => {
    // Mock ResizeObserver globally
    observeSpy = jasmine.createSpy('observe');
    disconnectSpy = jasmine.createSpy('disconnect');

    (window as any).ResizeObserver = function (cb: any) {
      callbackRef = cb; // Save callback for manual triggering
      return {
        observe: observeSpy,
        disconnect: disconnectSpy
      };
    };

    TestBed.configureTestingModule({
      declarations: [YourComponent],
    });

    const fixture = TestBed.createComponent(YourComponent);
    component = fixture.componentInstance;
  });

  it('should observe real iframe and override #root style', (done) => {
    // Create real iframe in DOM
    const iframe = document.createElement('iframe');
    iframe.id = 'testIframe';
    document.body.appendChild(iframe);

    // On iframe load, inject <div id="root">
    iframe.onload = () => {
      const iframeDoc = iframe.contentDocument!;
      const rootDiv = iframeDoc.createElement('div');
      rootDiv.id = 'root';
      iframeDoc.body.appendChild(rootDiv);

      const styleSpy = spyOn(component, 'overrideIframeInsideDivStyle').and.callThrough();

      // ✅ Call method under test
      component.observeIframeAndOverrideStyle(iframe);

      // ✅ Simulate resize event manually
      callbackRef([{ target: iframe, contentRect: { width: 100, height: 100 } }]);

      // ✅ Assertions
      expect(styleSpy).toHaveBeenCalledTimes(2); // Initial + ResizeObserver
      expect(observeSpy).toHaveBeenCalledWith(iframe);
      expect(rootDiv.style.padding).toBe('0px');

      // Clean up
      document.body.removeChild(iframe);
      done();
    };

    // Trigger load
    iframe.srcdoc = '<html><body></body></html>';
  });

  it('should disconnect observer on destroy', () => {
    component.resizeObserver = new ResizeObserver(() => {});
    component.ngOnDestroy();
    expect(disconnectSpy).toHaveBeenCalled();
  });
});
